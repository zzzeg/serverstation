(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/authoritative/consultDetails"],{185:
/*!******************************************************************************************************!*\
  !*** E:/yisheng_mingwo/serverMobile/trunk/main.js?{"page":"pages%2Fauthoritative%2FconsultDetails"} ***!
  \******************************************************************************************************/
/*! no static exports found */function(t,i,e){"use strict";(function(t){e(/*! uni-pages */4);s(e(/*! vue */2));var i=s(e(/*! ./pages/authoritative/consultDetails.vue */186));function s(t){return t&&t.__esModule?t:{default:t}}t(i.default)}).call(this,e(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */1)["createPage"])},186:
/*!***********************************************************************************!*\
  !*** E:/yisheng_mingwo/serverMobile/trunk/pages/authoritative/consultDetails.vue ***!
  \***********************************************************************************/
/*! no static exports found */function(t,i,e){"use strict";e.r(i);var s=e(/*! ./consultDetails.vue?vue&type=template&id=ecbb24f4& */187),n=e(/*! ./consultDetails.vue?vue&type=script&lang=js& */189);for(var a in n)"default"!==a&&function(t){e.d(i,t,(function(){return n[t]}))}(a);e(/*! ./consultDetails.vue?vue&type=style&index=0&lang=scss& */191);var o,g=e(/*! ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/runtime/componentNormalizer.js */10),l=Object(g["default"])(n["default"],s["render"],s["staticRenderFns"],!1,null,null,null,!1,s["components"],o);l.options.__file="E:/yisheng_mingwo/serverMobile/trunk/pages/authoritative/consultDetails.vue",i["default"]=l.exports},187:
/*!******************************************************************************************************************!*\
  !*** E:/yisheng_mingwo/serverMobile/trunk/pages/authoritative/consultDetails.vue?vue&type=template&id=ecbb24f4& ***!
  \******************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */function(t,i,e){"use strict";e.r(i);var s=e(/*! -!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--16-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./consultDetails.vue?vue&type=template&id=ecbb24f4& */188);e.d(i,"render",(function(){return s["render"]})),e.d(i,"staticRenderFns",(function(){return s["staticRenderFns"]})),e.d(i,"recyclableRender",(function(){return s["recyclableRender"]})),e.d(i,"components",(function(){return s["components"]}))},188:
/*!******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--16-0!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/template.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-uni-app-loader/page-meta.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!E:/yisheng_mingwo/serverMobile/trunk/pages/authoritative/consultDetails.vue?vue&type=template&id=ecbb24f4& ***!
  \******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! exports provided: render, staticRenderFns, recyclableRender, components */function(t,i,e){"use strict";e.r(i),e.d(i,"render",(function(){return n})),e.d(i,"staticRenderFns",(function(){return o})),e.d(i,"recyclableRender",(function(){return a})),e.d(i,"components",(function(){return s}));var s={xyDialog:function(){return e.e(/*! import() | components/xy-dialog/xy-dialog */"components/xy-dialog/xy-dialog").then(e.bind(null,/*! @/components/xy-dialog/xy-dialog.vue */328))}},n=function(){var t=this,i=t.$createElement;t._self._c},a=!1,o=[];n._withStripped=!0},189:
/*!************************************************************************************************************!*\
  !*** E:/yisheng_mingwo/serverMobile/trunk/pages/authoritative/consultDetails.vue?vue&type=script&lang=js& ***!
  \************************************************************************************************************/
/*! no static exports found */function(t,i,e){"use strict";e.r(i);var s=e(/*! -!./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./consultDetails.vue?vue&type=script&lang=js& */190),n=e.n(s);for(var a in s)"default"!==a&&function(t){e.d(i,t,(function(){return s[t]}))}(a);i["default"]=n.a},190:
/*!*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/babel-loader/lib!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--12-1!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/script.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!E:/yisheng_mingwo/serverMobile/trunk/pages/authoritative/consultDetails.vue?vue&type=script&lang=js& ***!
  \*******************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */function(t,i,e){"use strict";(function(t){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var s=a(e(/*! ../../common/api.js */17)),n=a(e(/*! ../../common/util.js */27));function a(t){return t&&t.__esModule?t:{default:t}}var o=function(){e.e(/*! require.ensure | components/xy-dialog/xy-dialog */"components/xy-dialog/xy-dialog").then(function(){return resolve(e(/*! ../../components/xy-dialog/xy-dialog.vue */328))}.bind(null,e)).catch(e.oe)},g={components:{xyDialog:o},data:function(){return{jianpanicon:"../../static/image/icon_yysr.png",showPlaceholder:!0,isRequest:!1,dialogtype:1,score:null,draft:null,content:"",lastMsgTime:"",page:1,size:10,userId:null,uploadParams:null,messageList:[],isFinish:null,isload:!1,textMsg:"",isHistoryLoading:!1,scrollAnimation:!1,scrollTop:0,scrollToView:"",msgList:[],msgImgList:[],myuid:0,RECORDER:t.getRecorderManager(),isVoice:!1,voiceTis:"按住 说话",recordTis:"手指上滑 取消发送",recording:!1,willStop:!1,initPoint:{identifier:0,Y:0},recordTimer:null,recordLength:0,AUDIO:t.createInnerAudioContext(),playMsgid:null,VoiceTimer:null,popupLayerClass:"",hideMore:!0,hideEmoji:!0,emojiList:[[{url:"100.gif",alt:"[微笑]"},{url:"101.gif",alt:"[伤心]"},{url:"102.gif",alt:"[美女]"},{url:"103.gif",alt:"[发呆]"},{url:"104.gif",alt:"[墨镜]"},{url:"105.gif",alt:"[哭]"},{url:"106.gif",alt:"[羞]"},{url:"107.gif",alt:"[哑]"},{url:"108.gif",alt:"[睡]"},{url:"109.gif",alt:"[哭]"},{url:"110.gif",alt:"[囧]"},{url:"111.gif",alt:"[怒]"},{url:"112.gif",alt:"[调皮]"},{url:"113.gif",alt:"[笑]"},{url:"114.gif",alt:"[惊讶]"},{url:"115.gif",alt:"[难过]"},{url:"116.gif",alt:"[酷]"},{url:"117.gif",alt:"[汗]"},{url:"118.gif",alt:"[抓狂]"},{url:"119.gif",alt:"[吐]"},{url:"120.gif",alt:"[笑]"},{url:"121.gif",alt:"[快乐]"},{url:"122.gif",alt:"[奇]"},{url:"123.gif",alt:"[傲]"}],[{url:"124.gif",alt:"[饿]"},{url:"125.gif",alt:"[累]"},{url:"126.gif",alt:"[吓]"},{url:"127.gif",alt:"[汗]"},{url:"128.gif",alt:"[高兴]"},{url:"129.gif",alt:"[闲]"},{url:"130.gif",alt:"[努力]"},{url:"131.gif",alt:"[骂]"},{url:"132.gif",alt:"[疑问]"},{url:"133.gif",alt:"[秘密]"},{url:"134.gif",alt:"[乱]"},{url:"135.gif",alt:"[疯]"},{url:"136.gif",alt:"[哀]"},{url:"137.gif",alt:"[鬼]"},{url:"138.gif",alt:"[打击]"},{url:"139.gif",alt:"[bye]"},{url:"140.gif",alt:"[汗]"},{url:"141.gif",alt:"[抠]"},{url:"142.gif",alt:"[鼓掌]"},{url:"143.gif",alt:"[糟糕]"},{url:"144.gif",alt:"[恶搞]"},{url:"145.gif",alt:"[什么]"},{url:"146.gif",alt:"[什么]"},{url:"147.gif",alt:"[累]"}],[{url:"148.gif",alt:"[看]"},{url:"149.gif",alt:"[难过]"},{url:"150.gif",alt:"[难过]"},{url:"151.gif",alt:"[坏]"},{url:"152.gif",alt:"[亲]"},{url:"153.gif",alt:"[吓]"},{url:"154.gif",alt:"[可怜]"},{url:"155.gif",alt:"[刀]"},{url:"156.gif",alt:"[水果]"},{url:"157.gif",alt:"[酒]"},{url:"158.gif",alt:"[篮球]"},{url:"159.gif",alt:"[乒乓]"},{url:"160.gif",alt:"[咖啡]"},{url:"161.gif",alt:"[美食]"},{url:"162.gif",alt:"[动物]"},{url:"163.gif",alt:"[鲜花]"},{url:"164.gif",alt:"[枯]"},{url:"165.gif",alt:"[唇]"},{url:"166.gif",alt:"[爱]"},{url:"167.gif",alt:"[分手]"},{url:"168.gif",alt:"[生日]"},{url:"169.gif",alt:"[电]"},{url:"170.gif",alt:"[炸弹]"},{url:"171.gif",alt:"[刀子]"}],[{url:"172.gif",alt:"[足球]"},{url:"173.gif",alt:"[瓢虫]"},{url:"174.gif",alt:"[翔]"},{url:"175.gif",alt:"[月亮]"},{url:"176.gif",alt:"[太阳]"},{url:"177.gif",alt:"[礼物]"},{url:"178.gif",alt:"[抱抱]"},{url:"179.gif",alt:"[拇指]"},{url:"180.gif",alt:"[贬低]"},{url:"181.gif",alt:"[握手]"},{url:"182.gif",alt:"[剪刀手]"},{url:"183.gif",alt:"[抱拳]"},{url:"184.gif",alt:"[勾引]"},{url:"185.gif",alt:"[拳头]"},{url:"186.gif",alt:"[小拇指]"},{url:"187.gif",alt:"[拇指八]"},{url:"188.gif",alt:"[食指]"},{url:"189.gif",alt:"[ok]"},{url:"190.gif",alt:"[情侣]"},{url:"191.gif",alt:"[爱心]"},{url:"192.gif",alt:"[蹦哒]"},{url:"193.gif",alt:"[颤抖]"},{url:"194.gif",alt:"[怄气]"},{url:"195.gif",alt:"[跳舞]"}],[{url:"196.gif",alt:"[发呆]"},{url:"197.gif",alt:"[背着]"},{url:"198.gif",alt:"[伸手]"},{url:"199.gif",alt:"[耍帅]"},{url:"200.png",alt:"[微笑]"},{url:"201.png",alt:"[生病]"},{url:"202.png",alt:"[哭泣]"},{url:"203.png",alt:"[吐舌]"},{url:"204.png",alt:"[迷糊]"},{url:"205.png",alt:"[瞪眼]"},{url:"206.png",alt:"[恐怖]"},{url:"207.png",alt:"[忧愁]"},{url:"208.png",alt:"[眨眉]"},{url:"209.png",alt:"[闭眼]"},{url:"210.png",alt:"[鄙视]"},{url:"211.png",alt:"[阴暗]"},{url:"212.png",alt:"[小鬼]"},{url:"213.png",alt:"[礼物]"},{url:"214.png",alt:"[拜佛]"},{url:"215.png",alt:"[力量]"},{url:"216.png",alt:"[金钱]"},{url:"217.png",alt:"[蛋糕]"},{url:"218.png",alt:"[彩带]"},{url:"219.png",alt:"[礼物]"}]],onlineEmoji:{"100.gif":"AbNQgA.gif","101.gif":"AbN3ut.gif","102.gif":"AbNM3d.gif","103.gif":"AbN8DP.gif","104.gif":"AbNljI.gif","105.gif":"AbNtUS.gif","106.gif":"AbNGHf.gif","107.gif":"AbNYE8.gif","108.gif":"AbNaCQ.gif","109.gif":"AbNN4g.gif","110.gif":"AbN0vn.gif","111.gif":"AbNd3j.gif","112.gif":"AbNsbV.gif","113.gif":"AbNwgs.gif","114.gif":"AbNrD0.gif","115.gif":"AbNDuq.gif","116.gif":"AbNg5F.gif","117.gif":"AbN6ET.gif","118.gif":"AbNcUU.gif","119.gif":"AbNRC4.gif","120.gif":"AbNhvR.gif","121.gif":"AbNf29.gif","122.gif":"AbNW8J.gif","123.gif":"AbNob6.gif","124.gif":"AbN5K1.gif","125.gif":"AbNHUO.gif","126.gif":"AbNIDx.gif","127.gif":"AbN7VK.gif","128.gif":"AbNb5D.gif","129.gif":"AbNX2d.gif","130.gif":"AbNLPe.gif","131.gif":"AbNjxA.gif","132.gif":"AbNO8H.gif","133.gif":"AbNxKI.gif","134.gif":"AbNzrt.gif","135.gif":"AbU9Vf.gif","136.gif":"AbUSqP.gif","137.gif":"AbUCa8.gif","138.gif":"AbUkGQ.gif","139.gif":"AbUFPg.gif","140.gif":"AbUPIS.gif","141.gif":"AbUZMn.gif","142.gif":"AbUExs.gif","143.gif":"AbUA2j.gif","144.gif":"AbUMIU.gif","145.gif":"AbUerq.gif","146.gif":"AbUKaT.gif","147.gif":"AbUmq0.gif","148.gif":"AbUuZV.gif","149.gif":"AbUliF.gif","150.gif":"AbU1G4.gif","151.gif":"AbU8z9.gif","152.gif":"AbU3RJ.gif","153.gif":"AbUYs1.gif","154.gif":"AbUJMR.gif","155.gif":"AbUadK.gif","156.gif":"AbUtqx.gif","157.gif":"AbUUZ6.gif","158.gif":"AbUBJe.gif","159.gif":"AbUdIO.gif","160.gif":"AbU0iD.gif","161.gif":"AbUrzd.gif","162.gif":"AbUDRH.gif","163.gif":"AbUyQA.gif","164.gif":"AbUWo8.gif","165.gif":"AbU6sI.gif","166.gif":"AbU2eP.gif","167.gif":"AbUcLt.gif","168.gif":"AbU4Jg.gif","169.gif":"AbURdf.gif","170.gif":"AbUhFS.gif","171.gif":"AbU5WQ.gif","172.gif":"AbULwV.gif","173.gif":"AbUIzj.gif","174.gif":"AbUTQs.gif","175.gif":"AbU7yn.gif","176.gif":"AbUqe0.gif","177.gif":"AbUHLq.gif","178.gif":"AbUOoT.gif","179.gif":"AbUvYF.gif","180.gif":"AbUjFU.gif","181.gif":"AbaSSJ.gif","182.gif":"AbUxW4.gif","183.gif":"AbaCO1.gif","184.gif":"Abapl9.gif","185.gif":"Aba9yR.gif","186.gif":"AbaFw6.gif","187.gif":"Abaiex.gif","188.gif":"AbakTK.gif","189.gif":"AbaZfe.png","190.gif":"AbaEFO.gif","191.gif":"AbaVYD.gif","192.gif":"AbamSH.gif","193.gif":"AbaKOI.gif","194.gif":"Abanld.gif","195.gif":"Abau6A.gif","196.gif":"AbaQmt.gif","197.gif":"Abal0P.gif","198.gif":"AbatpQ.gif","199.gif":"Aba1Tf.gif","200.png":"Aba8k8.png","201.png":"AbaGtS.png","202.png":"AbaJfg.png","203.png":"AbaNlj.png","204.png":"Abawmq.png","205.png":"AbaU6s.png","206.png":"AbaaXn.png","207.png":"Aba000.png","208.png":"AbarkT.png","209.png":"AbastU.png","210.png":"AbaB7V.png","211.png":"Abafn1.png","212.png":"Abacp4.png","213.png":"AbayhF.png","214.png":"Abag1J.png","215.png":"Aba2c9.png","216.png":"AbaRXR.png","217.png":"Aba476.png","218.png":"Abah0x.png","219.png":"Abdg58.png"},windowsState:"",redenvelopeData:{rid:null,from:null,face:null,blessing:null,money:null},userinfo:null}},onHide:function(){console.log("clearInterval"),clearInterval(this.interval)},onUnload:function(){console.log("clearInterval"),clearInterval(this.interval)},onLoad:function(i){var e=this;this.userId=i.userId,this.userinfo=t.getStorageSync("userinfo"),this.userinfo.icon&&(this.userinfo.icon=JSON.parse(this.userinfo.icon)[0].url),t.setNavigationBarTitle({title:i.title});var n={purpose:"useravatar"};s.default.getUploadParams({data:n}).then((function(t){console.log("getUploadParams"),console.log(t),e.uploadParams=t.data})),s.default.managerRead({data:{fromId:this.userinfo.id,toId:this.userId}}).then((function(t){})),this.initMsgList();var a=this;this.interval=setInterval((function(){a.updateLastMsg()}),1e4),this.AUDIO.onEnded((function(t){e.playMsgid=null})),this.RECORDER.onStart((function(t){e.recordBegin(t)})),this.RECORDER.onStop((function(t){e.recordEnd(t)}))},methods:{updateLastMsg:function(){var i,e=this;this.isRequest=!0;var a=!1;this.msgList.length<=0?a=!0:i=this.msgList[this.msgList.length-1].msg.id;var o={page:1,size:20,userId:this.userId},g=this;s.default.managerMsgPage({data:o}).then((function(s){console.log(s);n.default.formatDate(new Date,"yyyy-MM-dd");if("OK"==s.status&&s.list.length>0)for(var o=s.list.length-1;o>=0;o--){var l=s.list[o];if(a){var r=n.default.formatTimestamp(l.time,"yyyy-MM-dd"),f=n.default.formatTimestamp(l.time,"hh:mm");if(l.extJson){c={};var u=JSON.parse(l.extJson);c={type:"suggest",msg:{}};c.msg.id=l.id,c.msg.time=r,c.msg.content={},c.msg.content.text=u.content,c.msg.score=u.score,g.msgList.push(c)}else{var c={type:"user",msg:{}};c.msg.id=l.id,"txt"==l.type?c.msg.type="text":"img"==l.type?c.msg.type="img":"audio"==l.type&&(c.msg.type="voice"),c.msg.time=f,c.msg.userinfo={},l.fromId==e.userinfo.id?(c.msg.userinfo.uid=0,c.msg.userinfo.username=e.userinfo.name,c.msg.userinfo.face=e.userinfo.icon):(c.msg.userinfo.uid=l.userId,c.msg.userinfo.username=l.displayName,c.msg.userinfo.face=l.displayAvatar),c.msg.content={},"txt"==l.type?c.msg.content.text=l.content:"img"==l.type?c.msg.content.url=l.url:"audio"==l.type&&(c.msg.content.url=l.url,c.msg.content.length=l.content),g.msgList.push(c)}g.$nextTick((function(){t.createSelectorQuery().select(".msg-list").fields({size:!0,scrollOffset:!0},(function(t){console.log(t),g.scrollTop=t.scrollHeight})).exec(),g.$nextTick((function(){g.scrollAnimation=!0}))}))}i==l.id&&(a=!0)}g.isRequest=!1}))},clickEndSuggest:function(t){this.showPlaceholder=!0,this.content=t.msg.content.text,this.lastMsgTime=t.msg.time,console.log(t.msg.score),this.score=t.msg.score,console.log(this.score),this.dialogtype=2,this.$refs.dialog.confirm()},confirmButton:function(i){this.showPlaceholder=!0;var e=this;t.showModal({title:"确定提交",content:"提交用户即发送给用户，不可撤回修改，点击确定继续。",cancelColor:"#03BE90",confirmColor:"#03BE90",success:function(t){if(t.confirm){var n={context:i,recordId:e.recordId,communityId:e.communityId};e.draft&&(n={context:i,recordId:e.recordId,id:e.draft.id,communityId:e.communityId}),s.default.addAnalysis({data:n}).then((function(t){console.log(t),e.updateLastMsg()}))}}})},cancelButton:function(t){if(this.showPlaceholder=!0,console.log(t),""!=t){var i={context:t,recordId:this.recordId};this.draft&&(i={context:t,recordId:this.recordId,id:this.draft.id}),s.default.saveDraft({data:i}).then((function(t){console.log(t)}))}},clickSendPic:function(){var i=this;t.chooseImage({count:1,sizeType:["original","compressed"],success:function(e){console.log(e.tempFilePaths[0]),i.uploadParams?(t.showLoading({title:"图片上传中"}),t.uploadFile({url:i.uploadParams.url,filePath:e.tempFilePaths[0],name:"userAvatar",formData:{policy:i.uploadParams.policy,Signature:i.uploadParams.Signature},success:function(i){if(i.data){console.log(i.data);var e=JSON.parse(i.data);"OK"===e.status||t.showToast({title:e.message,icon:"none",duration:2e3})}},fail:function(){},complete:function(i){t.hideLoading(),200!==i.statusCode&&t.showToast({title:i.errMsg,icon:"none",duration:2e3})}})):t.showToast({title:"getUploadParams failed!",icon:"none",duration:2e3})},fail:function(t){}})},clickSuggest:function(){var t=this;this.showPlaceholder=!1;var i={recordId:this.recordId};s.default.findByRecordIdDraft({data:i}).then((function(i){if(console.log(i),"OK"==i.status&&null!=i.data&&""!=i.data)if(t.content=i.data.analysis,t.draft=i.data,i.data.lastUpdateTime){var e=n.default.formatTimestamp(i.data.lastUpdateTime,"yyyy-MM-dd"),s=n.default.formatTimestamp(i.data.lastUpdateTime,"hh:mm");t.lastMsgTime=e+" "+s}else{e=n.default.formatTimestamp(i.data.createTime,"yyyy-MM-dd"),s=n.default.formatTimestamp(i.data.createTime,"hh:mm");t.lastMsgTime=e+" "+s}else t.content="",t.lastMsgTime="";t.dialogtype=1,t.$refs.dialog.confirm()}))},switchVoice:function(){this.hideDrawer(),this.isVoice=!this.isVoice,this.isVoice?this.jianpanicon="../../static/image/icon_sxsr.png":this.jianpanicon="../../static/image/icon_yysr.png"},sendText:function(){if(this.hideDrawer(),this.textMsg){var t=this.textMsg,i={text:t};this.sendMsg(i,"text"),this.textMsg=""}},textareaFocus:function(){console.log("textareaFocus"),"showLayer"==this.popupLayerClass&&0==this.hideMore&&this.hideDrawer()},showPic:function(i){t.previewImage({indicator:"none",current:i.content.url,urls:this.msgImgList})},addVoiceMsg:function(t){this.msgList.push(t)},addTextMsg:function(t){this.msgList.push(t)},addImgMsg:function(t){t.msg.content=this.setPicSize(t.msg.content),this.msgImgList.push(t.msg.content.url),this.msgList.push(t)},sendMsg:function(t,i){var e;new Date;"text"==i?e={fromId:this.userinfo.id,toId:this.userId,type:"txt",content:t.text,source:1}:"img"==i?e={fromId:this.userinfo.id,toId:this.userId,type:"img",content:"[图片]",url:t.url,source:1}:"voice"==i&&(e={fromId:this.userinfo.id,toId:this.userId,type:"audio",content:t.sec,url:t.url,source:1}),this.updateLastMsg();var n=this;s.default.managerSend({data:e}).then((function(t){console.log(t),"OK"==t.status&&setTimeout((function(){n.updateLastMsg()}),1e3)}))},getImage:function(i){this.hideDrawer();var e=this;t.chooseImage({sourceType:[i],sizeType:["original","compressed"],success:function(i){for(var s=0;s<i.tempFilePaths.length;s++)t.getImageInfo({src:i.tempFilePaths[s],success:function(s){e.uploadParams?(t.showLoading({title:"图片上传中"}),t.uploadFile({url:e.uploadParams.url,filePath:i.tempFilePaths[0],name:"userAvatar",formData:{policy:e.uploadParams.policy,Signature:e.uploadParams.Signature},success:function(i){if(i.data){var s=JSON.parse(i.data);if("OK"===s.status){var n={url:s.data.location+s.data.filepath};e.sendMsg(n,"img")}else t.showToast({title:s.message,icon:"none",duration:2e3})}},fail:function(){},complete:function(i){t.hideLoading(),200!==i.statusCode&&t.showToast({title:i.errMsg,icon:"none",duration:2e3})}})):t.showToast({title:"getUploadParams failed!",icon:"none",duration:2e3})}})}})},screenMsg:function(i){if("system"==i.type)switch(i.msg.type){case"text":this.addSystemTextMsg(i);break;case"redEnvelope":this.addSystemRedEnvelopeMsg(i);break}else if("user"==i.type){switch(i.msg.type){case"text":this.addTextMsg(i);break;case"voice":this.addVoiceMsg(i);break;case"img":this.addImgMsg(i);break;case"redEnvelope":this.addRedEnvelopeMsg(i);break}console.log("用户消息"),i.msg.userinfo.uid!=this.myuid&&(console.log("振动"),t.vibrateLong())}this.$nextTick((function(){this.scrollToView="msg"+i.msg.id}))},initMsgList:function(){this.page=1,this.msgList=[],this.getMsgList(null)},getMsgList:function(t){var i=this,e={page:this.page,size:this.size,userId:this.userId},a=this;s.default.managerMsgPage({data:e}).then((function(e){if("OK"==e.status&&e.list.length>0){i.messageList=e.list;var s,o,g=n.default.formatDate(new Date,"yyyy-MM-dd"),l=0;e.list.forEach((function(t,e){var r=n.default.formatTimestamp(t.time,"yyyy-MM-dd"),f=n.default.formatTimestamp(t.time,"hh:mm");if(t.extJson){c={};var u=JSON.parse(t.extJson);c={type:"suggest",msg:{}};c.msg.id=t.id,c.msg.time=r+" "+f,c.msg.content={},c.msg.content.text=u.content,c.msg.score=u.score,a.msgList.unshift(c)}else{var c={type:"user",msg:{}};c.msg.id=t.id,"txt"==t.type?c.msg.type="text":"img"==t.type?c.msg.type="img":"audio"==t.type&&(c.msg.type="voice"),c.msg.time=f,c.msg.userinfo={},t.fromId==i.userinfo.id?(c.msg.userinfo.uid=0,c.msg.userinfo.username=i.userinfo.name,c.msg.userinfo.face=i.userinfo.icon):(c.msg.userinfo.uid=t.userId,c.msg.userinfo.username=t.displayName,c.msg.userinfo.face=t.displayAvatar),c.msg.content={},"txt"==t.type?c.msg.content.text=t.content:"img"==t.type?c.msg.content.url=t.url:"audio"==t.type&&(c.msg.content.url=t.url,c.msg.content.length=t.content),a.msgList.unshift(c)}if(g!=r){if(s!=r){c={};c={type:"system",msg:{id:0,type:"text",content:{text:r+" "+f}}},a.msgList.unshift(c),s=r}}else{c={};var d=n.default.formatTimestamp(t.time,"hh"),m=n.default.formatTimestamp(t.time,"mm");o!=d?(c={type:"system",msg:{id:0,type:"text",content:{text:d+":"+m}}},a.msgList.unshift(c),o=d):(m-l<-2&&(c={type:"system",msg:{id:0,type:"text",content:{text:d+":"+m}}},a.msgList.unshift(c)),l=m)}}));for(var r=0;r<a.msgList.length;r++)"user"==a.msgList[r].type&&"img"==a.msgList[r].msg.type&&(a.msgList[r].msg.content=a.setPicSize(a.msgList[r].msg.content),a.msgImgList.push(a.msgList[r].msg.content.url));a.$nextTick((function(){a.scrollTop=9999,a.$nextTick((function(){a.scrollAnimation=!0}))})),null!=t&&a.$nextTick((function(){a.scrollToView="msg"+t,a.$nextTick((function(){a.scrollAnimation=!0}))}))}a.isHistoryLoading=!1}))},setPicSize:function(i){var e=t.upx2px(350),s=t.upx2px(350);if(i.w>e||i.h>s){var n=i.w/i.h;i.w=n>1?e:s*n,i.h=n>1?e/n:s}return i},loadHistory:function(t){if(!this.isHistoryLoading){this.page++,this.isHistoryLoading=!0,this.scrollAnimation=!1;var i=this.msgList[0].msg.id;this.getMsgList(i)}},voiceBegin:function(t){console.log("voiceBegin"),t.touches.length>1||(this.recording=!0,this.initPoint.Y=t.touches[0].clientY,this.initPoint.identifier=t.touches[0].identifier,this.RECORDER.start({format:"mp3"}))},playVoice:function(t){this.playMsgid=t.id,this.AUDIO.src=t.content.url,this.$nextTick((function(){this.AUDIO.play()}))},recordBegin:function(t){var i=this;this.recording&&(this.voiceTis="松开 结束",this.recordLength=0,this.recordTimer=setInterval((function(){i.recordLength++}),1e3))},voiceCancel:function(){console.log("voiceCancel"),this.recording=!1,this.voiceTis="按住 说话",this.recordTis="手指上滑 取消发送",this.willStop=!0,this.RECORDER.stop()},voiceIng:function(i){if(console.log("voiceIng"),this.recording){var e=i.touches[0];this.initPoint.Y-e.clientY>=t.upx2px(100)?(this.willStop=!0,this.recordTis="松开手指 取消发送"):(this.willStop=!1,this.recordTis="手指上滑 取消发送")}},voiceEnd:function(t){console.log("voiceEnd："+this.recording),this.recording&&(this.recording=!1,this.voiceTis="按住 说话",this.recordTis="手指上滑 取消发送",this.RECORDER.stop(),console.log("recordTis"))},recordEnd:function(i){if(clearInterval(this.recordTimer),this.willStop)console.log("取消发送录音");else{console.log("e: "+JSON.stringify(i));var e={length:0,url:i.tempFilePath},s=parseInt(this.recordLength/60),n=this.recordLength%60;if(s=s<10?"0"+s:s,n=n<10?"0"+n:n,n<2)return void t.showToast({title:"录音时间太短",icon:"none",duration:2e3});e.length=s+":"+n,t.showLoading({title:"语音发送中"});var a=this;t.uploadFile({url:a.uploadParams.url,filePath:i.tempFilePath,name:"userAvatar",formData:{policy:a.uploadParams.policy,Signature:a.uploadParams.Signature},success:function(i){if(i.data){console.log(i.data);var e=JSON.parse(i.data);if("OK"===e.status){var s={url:e.data.location+e.data.filepath,sec:n};a.sendMsg(s,"voice")}else t.showToast({title:e.message,icon:"none",duration:2e3})}},fail:function(){},complete:function(i){t.hideLoading(),200!==i.statusCode&&t.showToast({title:i.errMsg,icon:"none",duration:2e3})}})}this.willStop=!1},showMore:function(){this.isVoice=!1,this.hideEmoji=!0,this.hideMore?(this.hideMore=!1,this.openDrawer()):this.hideDrawer()},openDrawer:function(){this.popupLayerClass="showLayer"},hideDrawer:function(){var t=this;this.popupLayerClass="",setTimeout((function(){t.hideMore=!0,t.hideEmoji=!0}),150)},discard:function(){}}};i.default=g}).call(this,e(/*! ./node_modules/@dcloudio/uni-mp-weixin/dist/index.js */1)["default"])},191:
/*!*********************************************************************************************************************!*\
  !*** E:/yisheng_mingwo/serverMobile/trunk/pages/authoritative/consultDetails.vue?vue&type=style&index=0&lang=scss& ***!
  \*********************************************************************************************************************/
/*! no static exports found */function(t,i,e){"use strict";e.r(i);var s=e(/*! -!./node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!./node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-2!./node_modules/postcss-loader/src??ref--8-oneOf-1-3!./node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-5!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!./consultDetails.vue?vue&type=style&index=0&lang=scss& */192),n=e.n(s);for(var a in s)"default"!==a&&function(t){e.d(i,t,(function(){return s[t]}))}(a);i["default"]=n.a},192:
/*!***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/mini-css-extract-plugin/dist/loader.js??ref--8-oneOf-1-0!./node_modules/css-loader/dist/cjs.js??ref--8-oneOf-1-1!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib/loaders/stylePostLoader.js!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-2!./node_modules/postcss-loader/src??ref--8-oneOf-1-3!./node_modules/sass-loader/dist/cjs.js??ref--8-oneOf-1-4!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/webpack-preprocess-loader??ref--8-oneOf-1-5!./node_modules/@dcloudio/vue-cli-plugin-uni/packages/vue-loader/lib??vue-loader-options!./node_modules/@dcloudio/webpack-uni-mp-loader/lib/style.js!E:/yisheng_mingwo/serverMobile/trunk/pages/authoritative/consultDetails.vue?vue&type=style&index=0&lang=scss& ***!
  \***********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/*! no static exports found */function(t,i,e){}},[[185,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/authoritative/consultDetails.js.map